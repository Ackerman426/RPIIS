# Лабораторная работа 5
 
### Цель: 
 
Освоить командные оболочки shell (для OS семейства Unix) и cmd (для OS семейства MS Windows):
+ изучить основные встроенные команды,
+ научиться писать файлы сценариев,
+ научиться соотносить командные оболочки для разных OS.
+ Освоить командное окружение для OS семейства Unix(утилиты из пакета GNU Core Utilities), и соответствующие им утилиты для OS семейства MS Windows.
### Условия задания
Вариант 32: Создать файл sh и bat, который выполняет следующее: 
На вход пакетному файлу приходит числа (N и M) (как параметры пакетного файла). Каждые N секунд будет создаваться папка и файл в ней (файлы будут называться 1, 2, 3 и т.д.), в котором записано общее время работы скрипта на данный момент. Скрипт должен работать M секунд. Следующую папку создавать внутри уже созданной. При каждом создании файла писать в консоль «Новый файл был создан»
## Batch файл
- ### Код программы :computer:
```batch
@echo off
Title Add amount of words in file to file's name
setlocal enabledelayedexpansion

set /p "folder=Write the path to the folder: "

if not exist "%folder%" (
    echo "This folder does't exist".
    pause
    exit 
)

for /r "%folder%" %%F in (*) do (
    set "file=%%~nxF"
    set "file_path=%%F"

    set "word_count=0"
 for /f "delims=" %%A in ('type "%%F"') do (
    for %%B in (%%A) do (
        set /a word_count+=1
    )
)

    set "new_name=!word_count!_!file!"
    ren "!file_path!" "!new_name!"
)
echo "Renaming over".
```
### Пример работы кода
![](1.png)

### Пояснение кода
```
@echo off:
```
Отключает вывод команд в консоль, чтобы при выполнении скрипта не отображались сами команды, а только результаты. Символ @ исключает вывод этой конкретной команды.
```
Title Add amount of words in file to file's name:
```
Устанавливает заголовок окна консоли. Этот заголовок будет виден в верхней части окна и помогает понять, что делает скрипт.
```
setlocal enabledelayedexpansion:
```
Включает задержанное расширение переменных. Это позволяет использовать измененные значения переменных внутри блоков кода (например, в циклах).
Запрос пути к папке
```
set /p "folder=Write the path to the folder: ":
```
Запрашивает у пользователя ввод пути к папке и сохраняет этот путь в переменной folder. Текст после = будет отображен как подсказка.
Проверка существования папки
```
if not exist "%folder%" (
    echo "This folder does't exist."
    pause
    exit 
)
```
Проверяет, существует ли указанная папка. Если папка не существует, выполняется блок кода в скобках.
```
echo "This folder doesn't exist.":
```
Выводит сообщение об ошибке в консоль, если папка не найдена.
```
pause:
```
Приостанавливает выполнение скрипта и ожидает нажатия любой клавиши. Это позволяет пользователю увидеть сообщение об ошибке перед закрытием окна.
exit:
Завершает выполнение скрипта, если папка не существует.
Обработка файлов в папке
```
for /r "%folder%" %%F in (*) do (
    set "file=%%~nxF"
    set "file_path=%%F"
for /r "%folder%" %%F in (*) do (:
```
Цикл for проходит по всем файлам в указанной папке и ее подкаталогах. %%F содержит полный путь к текущему файлу.
```
set "file=%%~nxF":
```
Сохраняет имя файла с расширением (например, example.txt) в переменной file. %%~nxF извлекает имя и расширение файла.
```
set "file_path=%%F":
```
Сохраняет полный путь к файлу в переменной file_path.
Подсчет слов в файле
```
    set "word_count=0"
    for /f "delims=" %%A in ('type "%%F"') do (
        for %%B in (%%A) do (
            set /a word_count+=1
        )
    )
set "word_count=0":
```
Инициализирует счетчик слов word_count, устанавливая его в 0.
```
for /f "delims=" %%A in ('type "%%F"') do (:
```
Использует команду type для чтения содержимого файла %%F. Каждая строка файла считывается в переменную %%A. delims= указывает, что строки не должны быть разбиты на части, и сохраняются целиком.
```
for %%B in (%%A) do (:
```
Для каждой строки %%A разбивает строку на слова. Каждое слово будет сохраняться в переменной %%B.
```
set /a word_count+=1:
```
Увеличивает счетчик word_count на 1 для каждого слова, найденного в строке.
Переименование файла
```
    set "new_name=!word_count!_!file!"
    ren "!file_path!" "!new_name!"
)
set "new_name=!word_count!_!file!":
```
Создает новое имя файла, добавляя количество слов перед именем файла. !word_count! и !file! используют задержанное расширение для получения актуальных значений.
```
ren "!file_path!" "!new_name!":
```
Переименовывает файл, используя команду ren. Это изменяет имя файла на новое, сформированное ранее.
Завершение скрипта
```
echo "Renaming over."
echo "Renaming over.":
```
Выводит сообщение о завершении процесса переименования файлов. Это позволяет пользователю видеть, что скрипт завершил свою работу.
## Bash файл
- ### Код программы :computer:
```bash
#!/bin/bash

read -p "Write the path to the folder: " folder

if [ ! -d "$folder" ]; then
    echo "This folder does't exist"
    exit 1
fi

find "$folder" -type f | while read -r file; do
    word_count=$(wc -w < "$file")
    

    filename=$(basename "$file")
    dirpath=$(dirname "$file")
    

    new_name="${word_count}_${filename}"
    

    mv "$file" "$dirpath/$new_name"
done

echo "Renaming over"
```
### Пояснение кода
```
#!/bin/bash:
```
Указывает, что скрипт должен выполняться с помощью интерпретатора Bash. Это шебанг (shebang), который сообщает системе, какой интерпретатор использовать для выполнения скрипта.
```
read -p "Write the path to the folder: " folder
read -p "Write the path to the folder: " folder:
```
Запрашивает у пользователя ввод пути к папке и сохраняет его в переменной folder. Параметр -p позволяет указать сообщение-подсказку.
```
if [ ! -d "$folder" ]; then
    echo "This folder does't exist"
    exit 1
fi
if [ ! -d "$folder" ]; then:
```
Проверяет, существует ли указанная папка и является ли она директорией. -d возвращает true, если путь является директорией. ! означает «не», так что условие выполняется, если папка не существует.
```
echo "This folder does't exist":
```
Если папка не существует, выводит сообщение об ошибке.
```
exit 1:
```
Завершает выполнение скрипта с кодом возврата 1, что указывает на ошибку.
```
find "$folder" -type f | while read -r file; do
find "$folder" -type f | while read -r file; do:
```
Использует команду find для поиска всех файлов (-type f) в указанной папке и её подкаталогах. Результаты передаются в цикл while, где каждый файл будет обрабатываться поочередно. read -r считывает имя файла, сохраняя при этом пробелы и специальные символы.
```
    word_count=$(wc -w < "$file")
word_count=$(wc -w < "$file"):
```
Подсчитывает количество слов в текущем файле с помощью команды wc -w, которая возвращает число слов. Результат сохраняется в переменной word_count. Использование < позволяет передать содержимое файла напрямую в команду wc.
```
    filename=$(basename "$file")
    dirpath=$(dirname "$file")
filename=$(basename "$file"):
```
Извлекает имя файла (без пути) из полного пути и сохраняет его в переменной filename
```
dirpath=$(dirname "$file"):
```
Извлекает путь к директории, в которой находится файл, и сохраняет его в переменной dirpath.
```
    new_name="${word_count}_${filename}"
new_name="${word_count}_${filename}":
```
Формирует новое имя файла, добавляя количество слов перед исходным именем файла. Например, если файл example.txt содержит 5 слов, новое имя будет 5_example.txt.
```
    mv "$file" "$dirpath/$new_name"
done
mv "$file" "$dirpath/$new_name":
```
Переименовывает файл, перемещая его в ту же директорию с новым именем. Команда mv используется для переименования или перемещения файлов.
```
done:
```
Завершает цикл while, когда все файлы обработаны.
```
echo "Renaming over"
echo "Renaming over":
```
Выводит сообщение о завершении процесса переименования файлов, сообщая пользователю, что скрипт завершил свою работу.
### Выводы: 
 В ходе выполнения лабораторной работы по освоению командных оболочек cmd (для операционных систем семейства MS Windows) и shell (для операционных систем семейства Unix) были получены практические навыки работы с консольными программами и командами в различных операционных системах. 
